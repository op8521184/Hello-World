# BMS系统功能开发文档

|修改人|修改日期|修改备注|版本|
|:--------|:--------|:------|:------|
|李浩宇| 2023-08-19 17:00|文档创建|v1.0.0|




## 功能结构图

![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/WMnIQ0Qhu8ERzuex.png)
   
## 目录
## [· 合同管理](#contract)
#### [· 服务项目信息](#contract_1)
#### [· 合同信息](#contract_2)
#### [· 待审批合同](#contract_3)
## [· 账单管理](#statement)
#### [· 对账单信息](#statement_1)
#### [· 对账单创建](#statement_2)
#### [· 待确认对账单](#statement_3)
## [· 费用管理](#expense)
#### [· 编辑订单费用](#expense_1)
#### [· 待审批费用](#expense_2)
#### [· 现金月结互转](#expense_3)
#### [· 费用接口](#expense_4)
## [· 基础数据](#baseData)
#### [· 供应商接口](#baseData_1)
#### [· 客户信息接口](#baseData_2)


## <span id="contract">一、合同管理</span>
#### <span id="contract_1">1、服务项目信息</span>
<br>

- **权限说明**
> 市场部人员：查询，添加，修改，失效

> 财务部人员：查询，修改财务属性，审批（是否需要审批待定）
- **服务项目列表** 
>![服务项目列表](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/ch8bVr7KSThOAMK1.png)

>增加：进入服务项目添加页面

>修改：进入服务项目详情页面，修改，其中财务人员可修改财务属性

>删除：服务项目失效，不影响历史单据
- **流程说明**
> ![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/kCm3T46SeFyBfGPN.png)


```
@startuml
title 市场部
(*) --> "<b>1.维护服务项目"

    if "<b>2.财务部审核" then         
    -->[true] "<b>3.财务部录入财务属性"
            
                --> "<b>4.邮件通知结果"
            
        
    else
      -->[false] "<b>4.邮件通知结果"
    endif
@enduml

```


#### <span id="contract_2">2、合同信息</span>
<br>

- **权限说明**
> 市场部人员：查询，添加，修改，提交，失效

> 财务部人员：查询，审批
- **合同列表** 
>![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/VT8TEysJdVtb2MZe.png)
>增加：进入合同添加页面，无服务项目无法创建合同。

>修改：进入合同详情页面，修改。

>删除：服务项目失效，不影响历史单据。

>提交：选中行项可进行提交，或进入详情页提交，提交途中 或 审批通过后不能修改。

>审批：选中行进行审批，或进入详情页审批，合同审批分两种情况，新增合同：合同生效，修改合同：失效未结算单据，重新计算相关费用。

>费用计算规则：合同添加，修改会触发合同费用自动计算，需确认规则。



#### <span id="contract_3">3、待审批合同</span>
<br>

- **权限说明**
> 财务部人员：查询，审批
- **合同列表** 
>![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/VT8TEysJdVtb2MZe.png)
> 查询：进入合同列表页，只查询市场人员已提交的合同

> 审批：选中行进行审批，或进入详情页审批，合同审批分两种情况，新增合同：合同生效，修改合同：失效未结算单据，重新计算相关费用。

>费用计算规则：合同添加，修改会触发合同费用自动计算，需确认规则。

- **流程业务说明**
> ![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/hgE4KBlgusT8Cl0y.png)


```
@startuml
title 市场部
(*) --> "<b>1.维护合同信息"
   if "<b>2.是否有服务项目" then         
    -->[true] "<b>3.合同提交"
    if "<b>4.财务部审核是否通过" then         
    -->[true] if "<b>5.是否新增" then 
               -->[true]"<b>6.合同生效" 
               --> "<b>11.邮件通知结果"
              else
                -->[false] "<b>7.把相关未结算的费用失效"
                --> "<b>8.重新计算费用"
                --> "<b>9.邮件通知财务部已重新计算"
                --> "<b>10.财务人员更新对账单，去除失效费用，加入新费用"
              endif
                --> "<b>11.邮件通知结果"
            
    else
      -->[false] "<b>11.邮件通知结果"
    endif
    
    else
      -->[false] "<b>3.无法创建"
    endif
    
@enduml

```

## <span id="statement">二、账单管理</span>
#### <span id="statement_1">1、对账单信息</span>
<br>

- **权限说明**
> 财务部人员：查询，增加，修改，失效，账单确认，账单退回，开票，开票确认，结算确认，抽查
- **账单列表** 
>![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/wKg9prnbxjJ80Z8n.png)
>增加：手动添加对账单，跳转未对账费用列表，无费用单据无法创建。

>修改：未确认账单可修改。

>删除：未确认账单可失效。

>账单确认：选中行项或进入详情页可进行账单确认，确认后账单锁定不能修改。

>账单退回：高级管理人员可对确认未开票账单进行退回操作，回到未确认状态。

>开票：对确认账单，选中行项或进入详情页可进行开票，按对应发票格式开票。

>开票确认：对已开票账单，选中行项或进入详情页可进行开票确认，填入发票号，开票日期。

>结算确认：对开票确认账单，选中行项或进入详情页可进行结算确认，填入收款金额，收款日期。

>抽查：对结算确认账单，选中行项或进入详情页可进行抽查，抽查标记。

>对账单自动生成：系统后台定时任务：对产生的费用，按天定时生成、按周定时生成、按月定时生成、月结触发、现金收款触发。
>按以上规则产生对账，根据时间段和客户的维度，加入同一张对账单行明细。



#### <span id="statement_2">2、对账单创建</span>
<br>

- **权限说明**
> 财务部人员：查询，创建

- **未对账费用列表** 
>![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/IrDWtL85U3n4uLYz.png)
> 查询：进入未对账费用列表页，查询未对账费用数据。
>
> 创建：选中行进行创建，无未对账费数据无法创建，创建完成后即去待确认对账单可查询。
> 

#### <span id="statement_3">3、待确认对账单</span>
<br>

- **权限说明**
> 财务部人员：查询，增加，修改，失效，账单确认

- **账单列表** 
>![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/wKg9prnbxjJ80Z8n.png)
>查询：进入账单列表页，只查询未确认账单数据。

>增加：手动添加对账单，跳转未对账费用列表，无费用单据无法创建。

>修改：未确认账单可修改。

>删除：未确认账单可失效。

>账单确认：选中行项或进入详情页可进行账单确认，确认后账单锁定不能修改。
>

## <span id="expense">三、费用管理</span>
#### <span id="expense_1">1、待审批费用</span>
<br>

- **权限说明**
> 财务部人员：查询，审批
- **费用列表** 
>![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/bUPFmcIPCZJQx9S5.png)
>查询：进入费用列表页面，只查询待审批费用。

>审批：选中行项或进入详情页可进行审批，审批结果发送邮件给费用单据负责人。

>备注：费用数据来源于：1.合同产生费用。2.外部系统接口传入

#### <span id="expense_2">2、编辑订单费用</span>
<br>

- **权限说明**
> 单证部人员：查询，修改，提交
 
> 客证部人员：查询，修改，提交
 
> 仓务部人员：查询，修改，提交
- **费用列表** 
>![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/IbtjTqh2dRgbrp3s.png)
>修改：选中行项或进入详情页可进行修改，可修改订单类型为：入库订单，增值服务工单 ，出库订单，ASN送货单。

>提交：选中行项或进入详情页可进行提交，提交后财务部进行审批。

>备注：费用数据来源于：1.合同产生费用。2.外部系统接口传入
>

#### <span id="expense_3">3、现金月结互转</span>
<br>

- **权限说明**
> 未知
- **费用列表** 
>![输入图片说明](https://raw.githubusercontent.com/op8521184/Hello-World/main/imgs/2023-08-20/fFHZO50MA5mFJV1i.png)
>查询：只查询无对账单和未确认对账的费用数据。

>现金月结互转：

>1.如果费用单有未确认对账单，需更新对账单，增加转换次数记录，

>2.如果已确认对账单转换失败
>


>备注：费用数据来源于：1.合同产生费用。2.外部系统接口传入

#### <span id="expense_4">4、费用接口</span>
<br>

- **权限说明**
> 系统间交互验证
- **请求URL**
> [http://localhost:8080/xxxx](#)

- **请求方式** 
>**POST**

- **Header参数**
>
| 名称      |     值 | 参数说明   |
| :-------- | :--------| :------ |
| Content-Type| application/json| |

- **请求参数**
>
| 请求参数      |     参数类型 |   是否必须   |参数说明   |
| :-------- | :--------| :------ | :------ |
| | string| 否| |


- **返回参数**
>
| 返回参数      |     参数类型 |   参数说明   |
| :-------- | :--------| :------ |
| code|   int|  执行结果code，0表示成功，其它表示失败，失败信息见msg字段|

- **请求示例**
>    
```
http://localhost:8080/request
```

- **返回示例**
>    
```
{
  "code": 0,
  "msg": ""
}
```

## <span id="baseData">四、基本数据</span>
#### <span id="baseData_1">1、客户数据接口</span>
<br>


#### <span id="baseData_2">2、供应商数据接口</span>
